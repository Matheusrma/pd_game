<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 5</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(600, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    game.load.image('back', 'assets/back.png');
    game.load.image('header', 'assets/header.png');
    game.load.image('star', 'assets/star.png'); //24x22
    game.load.image('playerAvatar', 'assets/player.png'); //64x64
}

var platforms;
var player;
var cursors;

var playerSpeed = 200;
var archiveSpeed = 100;

var archives;
var archiveCount = 0;
var archiveSpawnDelay = 200;
var lastArchiveSpawn = 0;

var scoreText;

var headerHeight = 30;

function create() {
    game.physics.startSystem(Phaser.Physics.ARCADE);
    game.add.sprite(0, 0, 'back');
    game.add.sprite(0, 0, 'header');

    archives = game.add.group();
    archives.enableBody = true;

    player = game.add.sprite(game.world.width/2 - 32, game.world.height - 32, 'playerAvatar');
    game.physics.arcade.enable(player);

    player.body.bounce.y = 0.2;
    player.body.gravity.y = 300;
    player.body.collideWorldBounds = true;

    scoreText = game.add.text(8, 8, 'Você baixou 0 arquivos.', { font: '14px Helvetica', fill: '#FFF' });
}

function update() {
    game.physics.arcade.overlap(player, archives, collectArchive, null, this);

    movePlayer(game.input.keyboard.createCursorKeys());

    spawnArchive();
}

var collectArchive = function(player, archive){
    archiveCount++;

    scoreText.text = 'Você baixou ' + archiveCount + ' arquivos.';

    archive.kill();
}

var spawnArchive = function(){
    if (game.time.time - lastArchiveSpawn < archiveSpawnDelay ) return;

    lastArchiveSpawn = game.time.time;

    var spawnX = Math.max(0, Math.min(Math.random() * game.world.width , game.world.width - 24));

    var archive = archives.create(spawnX, headerHeight + 12, 'star');

    archive.body.velocity.y += Math.random() * archiveSpeed;
}

var movePlayer = function(cursors){
    player.body.velocity.x = 0;
 
    if (cursors.left.isDown) {
        player.body.velocity.x = -playerSpeed;
    }
    else if (cursors.right.isDown) {
        player.body.velocity.x = playerSpeed;
    }
}

</script>

</body>
</html>